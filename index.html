<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <style>
        :root {
            --bs-box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 1);
        }

        .hide {
            display: none;
        }

        th:first-child,
        td:first-child {
            position: sticky;
            left: 0px;
        }

        #result-table::-webkit-scrollbar {
            display: none;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script>
        /*        function addMeasuredTireOptions() {
                    let select, i, option;
                    let min = 20, max = 65;
                    select = document.getElementById('tire-width');
                    for (i = min; i <= max; i += 1) {
                        option = document.createElement('option');
                        option.value = i;
                        option.text = i + "";
                        if (i == 40) option.selected = true;
                        select.add(option);
                    }
                }
        
                // addMeasuredTireOptions();
        
                document.addEventListener("DOMContentLoaded", () => {
        
                    addMeasuredTireOptions();
                    // add min to max options for tire width
        
                    // form validation
                    //
                    function validateForm() {
                        let valid = true;
                        let weight = weightInput.value;
                        let surfaceCondition = surfaceConditionInput.value;
                        let tireWidth = tireWidthInput.value;
                        let tireDiameter = tireDiameterInput.value;
                        let speed = speedInput.value / 1.609344;
                        let weightDist = weightDistInput.value;
                        let tireType = tireTypeInput.value;
        
                        let weightWarning = document.getElementById('weight-warning')
        
                        weightUnit = 'kg'
                        weight = Number(weight);
        
                        console.log(weight)
        
                        if (weight == "" || weight == null || weight < 0) {
                            weightInput.classList.add('invalid-form')
                            valid = false;
                        } else if (weightInput.classList.contains('invalid-form')) {
                            weightInput.classList.remove('invalid-form')
                        }
        
                        if (weight < 34 || weight > 205) {
                            weightWarning.classList.remove('hide');
                            weightInput.classList.add('invalid-form')
                            valid = false;
                        } else if (!weightWarning.classList.contains('hide')) {
                            weightWarning.classList.add('hide');
                            weightInput.classList.remove('invalid-form')
                        }
        
        
                        if (surfaceCondition == "null") {
                            surfaceConditionInput.classList.add('invalid-form')
                            valid = false;
                        } else if (surfaceConditionInput.classList.contains('invalid-form')) {
                            surfaceConditionInput.classList.remove('invalid-form')
                        }
        
                        if (tireWidth == "null") {
                            tireWidthInput.classList.add('invalid-form')
                            valid = false;
                        } else if (tireWidthInput.classList.contains('invalid-form')) {
                            tireWidthInput.classList.remove('invalid-form')
                        }
        
                        if (tireDiameter == "null") {
                            tireDiameterInput.classList.add('invalid-form')
                            valid = false;
                        } else if (tireDiameterInput.classList.contains('invalid-form')) {
                            tireDiameterInput.classList.remove('invalid-form')
                        }
        
                        if (tireDiameter == "null") {
                            tireDiameterInput.classList.add('invalid-form')
                            valid = false;
                        } else if (tireDiameterInput.classList.contains('invalid-form')) {
                            tireDiameterInput.classList.remove('invalid-form')
                        }
        
                        if (speed == "null") {
                            speedInput.classList.add('invalid-form');
                            valid = false;
                        } else if (speedInput.classList.contains('invalid-form')) {
                            speedInput.classList.remove('invalid-form');
                        }
        
                        if (weightDist == "null") {
                            weightDistInput.classList.add('invalid-form');
                            valid = false;
                        } else if (weightDistInput.classList.contains('invalid-form')) {
                            weightDistInput.classList.remove('invalid-form');
                        }
        
                        if (tireType == "null") {
                            tireTypeInput.classList.add('invalid-form');
                            valid = false;
                        } else if (tireTypeInput.classList.contains('invalid-form')) {
                            tireTypeInput.classList.remove('invalid-form');
                        }
        
                        // if (valid == false) {
                        //     validFormText.classList.add('show');
                        //     validFormText.classList.remove('hide');
                        //     return false
                        // }
                        // else {
                        //     validFormText.classList.add('hide');
                        //     validFormText.classList.remove('show');
                        // }
                        return valid
                    }
        
                    function getValueById(htmlID) {
                        return document.getElementById(htmlID).value;
                    }
        
                    function getValueByName(htmlName) {
                        return document.getElementsByName(htmlName)[0].value;
                    }
        
                    // ***********CALCULATIONS BELOW************** //
        
                    // receive inputs
                    let weightUnit = '';
                    let weightInput = document.getElementById('weight');
                    let weightUnitRadios = document.getElementsByName('weight-unit');
                    let surfaceConditionInput = document.getElementById('surface-condition');
                    let tireWidthInput = document.getElementById('tire-width');
                    let tireDiameterInput = document.getElementById('tire-diameter');
                    let speedInput = document.getElementById('average-speed');
                    let weightDistInput = document.getElementById('weight-dist');
                    let tireTypeInput = document.getElementById('tire-type');
        
                    let validFormText = document.getElementById('invalid-form-text');
                    let warningFormGroup = document.getElementById('warning-form-group');
                    let pinchFlatRec = document.getElementById('pinch-flat-rec');
        
                    // Submit button
                    let submitButton = document.getElementById('submit');
                    submitButton.addEventListener('click', submitHandle)
        
                    // On submit
                    function submitHandle(e) {
                        e.preventDefault();
                        console.log(e)
                        weightUnit = 'kg'
                        var weight = Number(weightInput.value);
        
                        // weight is in Number form
        
                        if (validateForm()) {
                            let K1 = calculateK1();
                            let K = 0.5 * (weight - 50) + K1
                            let CPP = calcCPP(K)
                            let speedCoeff = calcSpeedCoeff(Number(speedInput.value))
                            let weightDistCoeff = calcWeightDist();
                            let tireTypeCoeff = calcTireType();
        
                            let speedVal = Number(speedInput.value) * 0.44704
                            let tireWidthVal = Number(tireWidthInput.value)
        
                            console.log("weight", weight, "K1", K1, "K", K, "CPP", CPP, "speedCoeff", speedCoeff, "weightDistCoeff", weightDistCoeff, "tireTypeCoeff", tireTypeCoeff)
        
                            let finalPressures = {
                                front: (CPP * speedCoeff * weightDistCoeff.front) * tireTypeCoeff.front,
                                back: (CPP * speedCoeff * weightDistCoeff.back) * tireTypeCoeff.back,
                            }
        
                            let KE = 0.5 * weight * (speedVal ** 2);
                            let RE = 0.5 * (0.8 * tireWidthVal) * (Math.sqrt(((K) ** 2) - ((0.8 * tireWidthVal) ** 2)))
                            let Wnum1 = -2.56 * (K ** 2);
                            let Wsqrtnum2 = 6.5536 * (K ** 4);
                            let Wsqrtnum3 = 6.5536 * (-160000 - (800 * (weight) * (speedVal ** 2)) - ((weight ** 2) * (speedVal ** 4)))
        
                            let Wnum = Wnum1 + Math.sqrt(Wsqrtnum2 + Wsqrtnum3)
                            let Wdenom = (3.2768)
                            let W = Math.sqrt(-Wnum / Wdenom)
                            let PF = 2 * RE - KE
        
                            let PNewNum = Math.sqrt((((25 * (weight ** 2) * (speedVal ** 4)) + (20000 * weight * (speedVal ** 2)) + 400000) / (64 * (tireWidthVal ** 2))) + (0.64 * (tireWidthVal ** 2)))
                            let PNewDenom = K
                            let PfrontNew = (PNewNum / PNewDenom) * finalPressures.front;
                            let PbackNew = (PNewNum / PNewDenom) * finalPressures.back;
        
                            console.log("KE:", KE, "RE:", RE, "2*RE", 2 * RE, "KE-1.75RE", PF)
                            if (PF >= -500 && PF <= 0) {
                                pinchFlatRec.innerHTML = `Deine Auswahl erhöht das Risiko für Snakebites (Durchschlagsplattfüße).
                                    Um den optimalen Reifendruck mit reduziertem Risiko zu fahren, empfehlen wir einen Reifen mit einer gemessenen Breite von <span style="font-weight: 700;" id="w-rec">${Math.ceil(W)} mm</span>.
                                    <br><br>
                                    Falls diese Reifenbreite nicht zu deinem Rahmen passt, empfehlen wir einen nicht optimalen Luftdruck von <span style='font-weight: 700;'>${roundHalf(PfrontNew)} PSI</span> vorne und <span style='font-weight: 700;'>${roundHalf(PbackNew)} PSI</span> hinten, um Felgen und Reifen zu schützen.`
                            } else if (PF < -500) {
                                pinchFlatRec.innerHTML = `Deine Auswahl bringt ein <span style='font-weight: 700;'>SEHR HOHES</span> Risiko für Snakebites (Durchschlagsplattfüße) mit sich.
                                    Um deine optimalen Reifendrücke mit reduziertem Risiko zu fahren, empfehlen wir einen Reifen mit einer gemessenen Breite von <span style="font-weight: 700;" id="w-rec">${Math.ceil(W)} mm</span>.
                                    <br><br>
                                    Falls diese Reifenbreite nicht in deinen Rahmen passt, empfehlen wir einen nicht optimalen Luftdruck von <span style='font-weight: 700;'>${roundHalf(PfrontNew)} PSI</span> vorne und <span style='font-weight: 700;'>${roundHalf(PbackNew)} PSI</span> hinten, um Felgen und Reifen zu schützen.`
                            } else {
                                pinchFlatRec.innerHTML = '';
                            }
        
        
                            // console.log("KE:", KE, "RE:", RE);
                            // console.log("W:", W);
        
                            // if (KE >= 2 * RE) {
                            //     console.log("Condition for pinch flat hit")
                            // }
        
                            let frontPress = document.getElementById('front-press');
                            let backPress = document.getElementById('back-press');
                            let frontPressBar = document.getElementById('front-press-bar');
                            let backPressBar = document.getElementById('back-press-bar');
                            let backPressHeader = document.getElementById('back-press-header')
                            let frontPressHeader = document.getElementById('front-press-header')
                            let pressureBox1 = document.getElementById('pressure-box1')
                            let pressureBox2 = document.getElementById('pressure-box2')
                            frontPress.classList.remove('hide');
                            backPress.classList.remove('hide');
                            frontPressBar.classList.remove('hide');
                            backPressBar.classList.remove('hide');
                            backPressHeader.classList.remove('hide');
                            frontPressHeader.classList.remove('hide');
                            pressureBox1.classList.remove('hide');
                            pressureBox2.classList.remove('hide')
        
                            let frontVal = document.getElementById('front-val');
                            let backVal = document.getElementById('back-val');
                            let frontValBar = document.getElementById('front-val-bar');
                            let backValBar = document.getElementById('back-val-bar');
        
                            frontVal.innerHTML = roundHalf(finalPressures.front, 4);
                            backVal.innerHTML = roundHalf(finalPressures.back, 4);
                            frontValBar.innerHTML = round(finalPressures.front * 0.0689476, 1);
                            backValBar.innerHTML = round(finalPressures.back * 0.0689476, 1);
        
        
                            // submitFormDataToSpreadsheetsAndKlaviyo()
        
                            return finalPressures
                        } else {
                            let frontPress = document.getElementById('front-press');
                            let backPress = document.getElementById('back-press');
                            let frontPressBar = document.getElementById('front-press-bar');
                            let backPressBar = document.getElementById('back-press-bar');
                            frontPress.classList.add('hide');
                            backPress.classList.add('hide');
                            frontPressBar.classList.add('hide');
                            backPressBar.classList.add('hide');
                            // document.getElementById('all-good-img').classList.add('hide');
                            // document.getElementById('warning-img').classList.add('hide');
                            // document.getElementById('bad-img').classList.add('hide');
                            // document.getElementById('warning-form-group').classList.add('hide');
        
                        }
                    }
        
                    // Calculate center point pressure
                    function calcCPP(K) {
                        let width = Number(tireWidthInput.value);
                        let diameter = Number(tireDiameterInput.value);
        
                        console.log("width", width, "diameter", diameter);
        
                        let num = ((-0.00006 * (width ** 3)) + (0.0079 * (width ** 2)) - (0.4102 * width) + (12.725)) * (-226.44);
        
                        let denom = (((((-0.5 * 9.81) / (K * (20 / width))) + (width + (diameter / 2))) ** 2) - ((width + (diameter / 2)) ** 2))
        
                        console.log("num", num, "denom", denom);
        
                        return (num / denom)
                    }
        
                    // Calculate speed coefficient
                    function calcSpeedCoeff(speed) {
                        let y0 = 10, x0 = 0.97, y1 = 33, x1 = 1.03;
                        let num = (x1 * speed) - (x0 * speed) - (x1 * y0) + (x0 * y0) + (y1 * x0) - (x0 * y0);
                        let denom = y1 - y0;
                        return num / denom
                    }
        
                    // Calculate weight distribution coefficient
                    function calcWeightDist() {
                        let weightDistObj = {
                            front: 0,
                            back: 0
                        }
                        switch (weightDistInput.value) {
                            case 'tr-tt-track':
                                weightDistObj.front = 1;
                                weightDistObj.back = 1;
                                break
                            case 'road':
                                weightDistObj.front = 0.985;
                                weightDistObj.back = 1.01;
                                break
                            case 'gravel':
                                weightDistObj.front = 0.975;
                                weightDistObj.back = 1.02;
                                break
                            case 'mountain':
                                weightDistObj.front = 0.97;
                                weightDistObj.back = 1.03;
                                break
                        }
                        return weightDistObj
                    }
        
                    function calcTireType() {
                        let tireTypeObj = {
                            front: 0,
                            back: 0
                        }
                        switch (tireTypeInput.value) {
                            case 'high-perf-tubeless-latex':
                                tireTypeObj.front = 1;
                                tireTypeObj.back = 1;
                                break
                            case 'mid-range-tubeless-latex':
                                tireTypeObj.front = 0.97;
                                tireTypeObj.back = 0.97;
                                break
                            case 'mid-range-butyl':
                                tireTypeObj.front = 0.94;
                                tireTypeObj.back = 0.94;
                                break
                            case 'puncture-resistant-tubeless-latex':
                                tireTypeObj.front = 0.91;
                                tireTypeObj.back = 0.91;
                                break
                        }
                        return tireTypeObj
        
                    }
        
                    // Calculate K1
                    function calculateK1() {
                        switch (surfaceConditionInput.value) {
                            case 'track-indoor-wood':
                                K1 = 354;
                                break
                            case 'track-outdoor-wood':
                                K1 = 294;
                                break
                            case 'new-pavement':
                                K1 = 261;
                                break
                            case 'worn-pavement':
                                K1 = 246.5;
                                break
                            case 'cat1-gravel':
                                K1 = 235.5;
                                break
                            case 'poor-pavement':
                                K1 = 225;
                                break
                            case 'cat2-gravel':
                                K1 = 212.5;
                                break
                            case 'cobblestone':
                                K1 = 199;
                                break
                            case 'cat3-gravel':
                                K1 = 187;
                                break
                            case 'cat4-gravel':
                                K1 = 170;
                                break
                        }
                        return K1
                    }
        
                    function round(value, precision) {
                        var multiplier = Math.pow(100, precision || 0) / 5;
                        return Math.round(value * multiplier) / multiplier;
                    }
        
                    function roundHalf(num) {
                        return Math.round(num * 2) / 2;
                    }
        
                });
            */</script>
</head>


<body class="p-3 m-0 border-0 bd-example border-0 pb-4 mb-5" data-bs-theme="dark">
    <div class="d-grid gap-2 mb-2 justify-content-center">
        <div class="row">
            <div class="col text-end">
                <label for="weight" class="col-form-label"
                data-bs-toggle="tooltip" data-bs-placement="bottom"
        data-bs-title="(Rider + Bike + Gear)">Gesamtgewicht:</label>
            </div>
            <div class="col align-middle">
                <div class="input-group mb-2 has-validation">
                    <input type="number" class="form-control" id="weight" placeholder="Gesamtgewicht" min="34"
                        max="205">
                    <span class="input-group-text">kg</span>
                    <!-- <div class="invalid-feedback" id="weight-warning">
                        Weight input between 34 – 205 kg required.
                    </div> -->
                </div>
            </div>
        </div>
    </div>

    <!-- <div class="d-grid gap-2 mb-2">
        <button class="btn btn-primary" type="button" id="submit">Calculate</button>
    </div> -->
    <!-- <div id="results-surface">
        <div class="input-group mb-2">
            <div class="form-floating">
                <select name="surface-condition" id="surface-condition" class="form-select">
                    <option value="track-indoor-wood" style="display: none;">Track (Indoor Wood)</option>
                    <option value="track-outdoor-wood" style="display: none;">Bahn (Außen, Beton)</option>
                    <option value="new-pavement">Neuer Asphalt</option>
                    <option value="worn-pavement">Abgenutzter Asphalt / Einige Risse</option>
                    <option value="cat1-gravel" selected>Gravel 1: Feiner Schotter / harter Untergrund</option>
                    <option value="poor-pavement">Schlechter Asphalt / Splittbelag</option>
                    <option value="cat2-gravel">Gravel 2: Grobkörnigerer Schotter</option>
                    <option value="cobblestone">Kopfsteinpflaster</option>
                    <option value="cat3-gravel">Gravel 3: Lockerer Schotter / größere Steine</option>
                    <option value="cat4-gravel">Gravel 4: Sehr rau / schwer befahrbar</option>
                </select>
                <label for="surface-condition">Fahrbahn</label>
            </div>
        </div>
    </div> -->

    <div class="table-responsive" id="result-table">
        <table class="table table-bordered table-striped-columns align-middle text-center">
            <thead>
                <tr class="border-0 border-secondary-subtle">
                    <th class="text-warning border-top-0 border-start-0 text-end">km/h</th>
                    <th class="text-warning border-top">18</th>
                    <th class="text-warning border-top">20</th>
                    <th class="text-warning border-top">22</th>
                    <th class="text-warning border-top">24</th>
                    <th class="text-warning border-top">26</th>
                    <th class="text-warning border-top">28</th>
                    <th class="text-warning border-top">30</th>
                </tr>
            </thead>
            <tbody>
                <tr class="">
                    <td class="text-start text-info">Neuer<br>Asphalt</td>
                    <td id="new-pavement-18"></td>
                    <td id="new-pavement-20"></td>
                    <td id="new-pavement-22"></td>
                    <td id="new-pavement-24"></td>
                    <td id="new-pavement-26"></td>
                    <td id="new-pavement-28"></td>
                    <td id="new-pavement-30"></td>
                </tr>
                <tr class="">
                    <td class="text-start text-info">Abgenutzter<br>Asphalt</td>
                    <td id="worn-pavement-18"></td>
                    <td id="worn-pavement-20"></td>
                    <td id="worn-pavement-22"></td>
                    <td id="worn-pavement-24"></td>
                    <td id="worn-pavement-26"></td>
                    <td id="worn-pavement-28"></td>
                    <td id="worn-pavement-30"></td>
                </tr>
                <tr class="">
                    <td class="text-start text-info">Gravel 1:<br>Eben & hart</td>
                    <td id="cat1-gravel-18"></td>
                    <td id="cat1-gravel-20"></td>
                    <td id="cat1-gravel-22"></td>
                    <td id="cat1-gravel-24"></td>
                    <td id="cat1-gravel-26"></td>
                    <td id="cat1-gravel-28"></td>
                    <td id="cat1-gravel-30"></td>
                </tr>
                <tr class="">
                    <td class="text-start text-info">Schlechter<br>Asphalt</td>
                    <td id="poor-pavement-18"></td>
                    <td id="poor-pavement-20"></td>
                    <td id="poor-pavement-22"></td>
                    <td id="poor-pavement-24"></td>
                    <td id="poor-pavement-26"></td>
                    <td id="poor-pavement-28"></td>
                    <td id="poor-pavement-30"></td>
                </tr>
                <tr class="">
                    <td class="text-start text-info">Gravel 2:<br>Mäßig rau</td>
                    <td id="cat2-gravel-18"></td>
                    <td id="cat2-gravel-20"></td>
                    <td id="cat2-gravel-22"></td>
                    <td id="cat2-gravel-24"></td>
                    <td id="cat2-gravel-26"></td>
                    <td id="cat2-gravel-28"></td>
                    <td id="cat2-gravel-30"></td>
                </tr>
                <tr class="">
                    <td class="text-start text-info">Kopfstein-<br>pflaster</td>
                    <td id="cobblestone-18"></td>
                    <td id="cobblestone-20"></td>
                    <td id="cobblestone-22"></td>
                    <td id="cobblestone-24"></td>
                    <td id="cobblestone-26"></td>
                    <td id="cobblestone-28"></td>
                    <td id="cobblestone-30"></td>
                </tr>
                <tr class="">
                    <td class="text-start text-info">Gravel 3:<br>Grobkörnig</td>
                    <td id="cat3-gravel-18"></td>
                    <td id="cat3-gravel-20"></td>
                    <td id="cat3-gravel-22"></td>
                    <td id="cat3-gravel-24"></td>
                    <td id="cat3-gravel-26"></td>
                    <td id="cat3-gravel-28"></td>
                    <td id="cat3-gravel-30"></td>
                </tr>
                <tr class="">
                    <td class="text-start text-info">Gravel 4:<br>Extrem rau</td>
                    <td id="cat4-gravel-18"></td>
                    <td id="cat4-gravel-20"></td>
                    <td id="cat4-gravel-22"></td>
                    <td id="cat4-gravel-24"></td>
                    <td id="cat4-gravel-26"></td>
                    <td id="cat4-gravel-28"></td>
                    <td id="cat4-gravel-30"></td>
                </tr>
                <!-- track-indoor-wood" 
track-outdoor-wood"
new-pavement">Neuer
worn-pavement">Abge
cat1-gravel" select
poor-pavement">Schl
cat2-gravel">Gravel
cobblestone">Kopfst
cat3-gravel">Gravel
cat4-gravel">Gravel -->
        </table>
    </div>
    <div class="d-grid gap-2 mb-3 justify-content-center">
        <div class="btn-group" role="group" aria-label="">
            <input type="radio" class="btn-check" name="unit" id="psi" autocomplete="off" checked>
            <label class="btn btn-outline-light btn-sm rounded-start-pill px-3" for="psi">psi</label>
            <input type="radio" class="btn-check" name="unit" id="bar" autocomplete="off">
            <label class="btn btn-outline-light btn-sm rounded-end-pill px-3" for="bar">Bar</label>
        </div>
    </div>

    <!-- <div id="results-speed">
        <div class="input-group mb-2 has-validation">
            <div class="form-floating">
                <select name="average-speed" id="average-speed" class="form-select">
                    <option value="18"></option>
                    <option value="20"></option>
                    <option value="22" selected>22</option>
                    <option value="24"></option>
                    <option value="26"></option>
                    <option value="28"></option>
                    <option value="30"></option>
                </select>
                <label for="average-speed">Durchschnittsgeschwindigkeit</label>
            </div>
            <span class="input-group-text">km/h</span>
        </div>
    </div> -->

    <div class="d-grid gap-2 p-2 fixed-bottom bg-primary-subtle shadow">
        <div class="btn-group" role="group" aria-label="">
            <input type="radio" class="btn-check" name="which-tire" id="tire-front" autocomplete="off" checked>
            <label class="btn btn-outline-primary rounded-start-pill" for="tire-front">Vorne</label>
            <input type="radio" class="btn-check" name="which-tire" id="tire-back" autocomplete="off">
            <label class="btn btn-outline-primary rounded-end-pill" for="tire-back">Hinten</label>
        </div>
    </div>

    <div class="accordion mb-2" id="accordionExample">
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne" id="accordionName">
                    40 / 622 mm, Mid Range, Triathlon/TT/Track
                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <div class="input-group mb-2 has-validation">
                        <div class="form-floating">
                            <select name="tire-width" id="tire-width" class="form-select">
                            </select>
                            <label for="tire-width">Reifen Breite gemessen</label>
                        </div>
                        <span class="input-group-text">mm</span>
                    </div>
                    <div class="input-group mb-2 has-validation">
                        <div class="form-floating">
                            <select name="tire-diameter" id="tire-diameter" class="form-select">
                                <option value="622" selected>700C/29"</option>
                                <option value="571">650C</option>
                                <option value="584">650B/27.5"</option>
                                <option value="559">26"</option>
                            </select>
                            <label for="tire-width">Reifen Durchmesser</label>
                        </div>
                    </div>
                    <div class="input-group mb-2 has-validation">
                        <div class="form-floating">
                            <select name="tire-type" id="tire-type" class="form-select">
                                <option value="high-perf-tubeless-latex">Race Tubeless / Latexschlauch</option>
                                <option value="mid-range-tubeless-latex" selected>Standard Tubeless / Latexschlauch
                                </option>
                                <option value="mid-range-butyl">Standard Butylschlauch</option>
                                <option value="puncture-resistant-tubeless-latex">Pannensicher Tubeless /
                                    Latexschlauch
                                </option>
                            </select>
                            <label for="tire-type">Reifen Art/Material</label>
                        </div>
                    </div>
                    <div class="input-group mb-2 has-validation">
                        <div class="form-floating">
                            <select name="weight-dist" id="weight-dist" class="form-select">
                                <option value="tr-tt-track">50/50 (Triathlon/TT/Track Bike)</option>
                                <option value="road">48/52 (Road Bike)</option>
                                <option value="gravel" selected>47/53 (Gravel Bike)</option>
                                <option value="mountain">46.5/53.5 (Mountain Bike)</option>
                            </select>
                            <label for="weight-dist">Gewichtsverteilung</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- <div class="results-form-group">
        <br>
        <div class="form-group">
            <div class="col-sm-8  col-xs-8">
                <div class="pressure-boxes hide" id="pressure-box1">
                    <h4 style="padding-bottom: 10px;" class="final-text hide" id="back-press-header">
                        <b> Rear Tire </b>
                    </h4>
                    <h4 class="final-text hide" id="back-press"> <b>PSI</b> <span style="padding-left: 20px"
                            id="back-val"></span> </h4>
                    <h4 class="final-text hide" id="back-press-bar">
                        <b> BAR</b> <span style="padding-left: 20px" id="back-val-bar"></span>
                    </h4>
                </div>
            </div>
            <div class="col-sm-8  col-xs-8">
                <div class="pressure-boxes hide" id="pressure-box2">
                    <h4 style="padding-bottom: 10px;" class="final-text hide" id="front-press-header"><b>
                            Front Tire </b></h4>
                    <h4 class="final-text hide" id="front-press"> <b> PSI </b> <span style="padding-left: 20px"
                            id="front-val"></span> </h4>
                    <h4 class="final-text hide" id="front-press-bar">
                        <b> BAR</b> <span style="padding-left: 20px" id="front-val-bar"></span>
                    </h4>
                </div>
            </div>
        </div>
    </div>
    <div class="warning-form-group hide" id="warning-form-group">
        <p class="pinch-flat-rec" id="pinch-flat-rec"></p>
    </div> -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>
    <script>
        function addMeasuredTireOptions() {
            let select, i, option;
            let min = 20, max = 65;
            select = document.getElementById('tire-width');
            for (i = min; i <= max; i += 1) {
                option = document.createElement('option');
                option.value = i;
                option.text = i + "";
                if (i == 40) option.selected = true;
                select.add(option);
            }
        }

        let weight = $("#weight");
        let tireWidth = $("#tire-width");
        let tireDiameter = $("#tire-diameter");
        let weightDist = $("#weight-dist");
        let tireType = $("#tire-type");

        let surfaceTypes = ["new-pavement", "worn-pavement", "cat1-gravel", "poor-pavement", "cat2-gravel", "cobblestone", "cat3-gravel", "cat4-gravel"];
        let speedTypes = [18, 20, 22, 24, 26, 28, 30];

        const K1_VALUES = {
            // 'track-indoor-wood': 354,
            // 'track-outdoor-wood': 294,
            'new-pavement': 261,
            'worn-pavement': 246.5,
            'cat1-gravel': 235.5,
            'poor-pavement': 225,
            'cat2-gravel': 212.5,
            'cobblestone': 199,
            'cat3-gravel': 187,
            'cat4-gravel': 170
        };

        const WEIGHT_DISTRIBUTIONS = {
            'tr-tt-track': { front: 1, back: 1 },
            'road': { front: 0.985, back: 1.01 },
            'gravel': { front: 0.975, back: 1.02 },
            'mountain': { front: 0.97, back: 1.03 }
        };

        const TIRE_TYPE_FACTORS = {
            'high-perf-tubeless-latex': { front: 1, back: 1 },
            'mid-range-tubeless-latex': { front: 0.97, back: 0.97 },
            'mid-range-butyl': { front: 0.94, back: 0.94 },
            'puncture-resistant-tubeless-latex': { front: 0.91, back: 0.91 }
        };

        function round(value, precision) {
            var multiplier = Math.pow(100, precision || 0) / 5;
            return Math.round(value * multiplier) / multiplier;
        }
        function roundHalf(num) {
            return Math.round(num * 2) / 2;
        }

        function calcCPP(K) {
            let width = Number(tireWidth.val());
            let diameter = Number(tireDiameter.val());
            let num = ((-0.00006 * (width ** 3)) + (0.0079 * (width ** 2)) - (0.4102 * width) + (12.725)) * (-226.44);
            let denom = (((((-0.5 * 9.81) / (K * (20 / width))) + (width + (diameter / 2))) ** 2) - ((width + (diameter / 2)) ** 2))
            return (num / denom)
        }
        function calcSpeedCoeff(speed) {
            let y0 = 10, x0 = 0.97, y1 = 33, x1 = 1.03;
            let num = (x1 * speed) - (x0 * speed) - (x1 * y0) + (x0 * y0) + (y1 * x0) - (x0 * y0);
            let denom = y1 - y0;
            return num / denom
        }

        $(window).on("load", function () {
            addMeasuredTireOptions();
            for (var iD in localStorage) {
                if (!localStorage.hasOwnProperty(iD)) continue;
                $("#" + iD).val(localStorage[iD]);
                setAccordionName();
            }
            calcAll();
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
        });
        $("select, input").on("change", function () {
            setAccordionName();
            localStorage.setItem(this.id, this.value);
            calcAll();
        });
        function setAccordionName() {
            $("#accordionName").text(
                $("#tire-width").val() + " / " +
                $("#tire-diameter").val() + ", " +
                $("#tire-type").find("option:selected").text().trim().replace(/(\s\/\s).*/m, "") + ", " +
                $("#weight-dist").find("option:selected").text().trim().replace(/^.*\(([^\)]+) Bike\).*$/, "$1")
            )
        }
        function calcAll() {
            for (const surface in K1_VALUES) {
                for (let speed of speedTypes) {
                    calcOne(surface, speed);
                }
            };
        }
        function calcOne(surface, speed) {
            let K1 = K1_VALUES[surface]
            let K = 0.5 * (weight.val() - 50) + K1
            let CPP = calcCPP(K)
            let speedCoeff = calcSpeedCoeff(Number(speed))
            let weightDistCoeff = WEIGHT_DISTRIBUTIONS[weightDist.val()];
            let tireTypeCoeff = TIRE_TYPE_FACTORS[tireType.val()];

            let speedVal = Number(speed) * 0.44704
            let tireWidthVal = Number(tireWidth.val())

            console.log("weight", weight, "K1", K1, "K", K, "CPP", CPP, "speedCoeff", speedCoeff, "weightDistCoeff", weightDistCoeff, "tireTypeCoeff", tireTypeCoeff)

            let front = (CPP * speedCoeff * weightDistCoeff.front) * tireTypeCoeff.front
            let back = (CPP * speedCoeff * weightDistCoeff.back) * tireTypeCoeff.back

            if ($('input[name=which-tire]:checked').attr("id") == "tire-front") {
                if ($('input[name=unit]:checked').attr("id") == "psi") {
                    $("#" + surface + "-" + speed).text(roundHalf(front, 4).toFixed(1))
                } else {
                    $("#" + surface + "-" + speed).text(round(front * 0.0689476, 1).toFixed(2))
                }
            } else {
                if ($('input[name=unit]:checked').attr("id") == "psi") {
                    $("#" + surface + "-" + speed).text(roundHalf(back, 4).toFixed(1))
                } else {
                    $("#" + surface + "-" + speed).text(round(back * 0.0689476, 1).toFixed(2))
                }
            }

        }
    </script>
</body>

</html>